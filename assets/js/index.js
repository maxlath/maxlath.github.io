// Generated by CoffeeScript 1.10.0
(function() {
  var elements, elementsList, expandTabBar, getElementData, lastSelectedTab, lastStateIsExpanded, margin, placeHolderEl, reduceTabBar, select, selectTab, tabsList, unselect, updateTabsPosition,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  placeHolderEl = document.querySelector('#expanded-tabs-placeholder');

  tabsList = ['about', 'projects', 'articles', 'posts', 'links'];

  elementsList = ['tabs'].concat(tabsList);

  elements = {};

  getElementData = function(elName) {
    var el;
    el = document.querySelector("#" + elName);
    el.top = el.offsetTop;
    el.bottom = el.offsetTop + el.offsetHeight;
    if (indexOf.call(tabsList, elName) >= 0) {
      el.tab = document.querySelector("a[href='#" + elName + "']");
    }
    return el;
  };

  elementsList.forEach(function(elName) {
    return elements[elName] = getElementData(elName);
  });

  console.log('elements', window.elements = elements);

  margin = 100;

  updateTabsPosition = function(e) {
    var about, articles, links, pageYOffset, posts, projects, tabs;
    pageYOffset = window.pageYOffset;
    tabs = elements.tabs, about = elements.about, projects = elements.projects, articles = elements.articles, posts = elements.posts, links = elements.links;
    if (pageYOffset > tabs.bottom) {
      expandTabBar();
    } else {
      reduceTabBar();
    }
    if (pageYOffset < about.top) {
      return selectTab(null);
    } else if (pageYOffset < projects.top - margin) {
      return selectTab('about');
    } else if (pageYOffset < articles.top - margin) {
      return selectTab('projects');
    } else if (pageYOffset < posts.top - margin) {
      return selectTab('articles');
    } else if (pageYOffset < links.top - margin) {
      return selectTab('posts');
    } else {
      return selectTab('links');
    }
  };

  lastStateIsExpanded = false;

  lastSelectedTab = null;

  expandTabBar = function() {
    if (lastStateIsExpanded) {
      return;
    }
    placeHolderEl.style.display = 'block';
    elements.tabs.classList.add('expanded');
    return lastStateIsExpanded = true;
  };

  reduceTabBar = function() {
    if (!lastStateIsExpanded) {
      return;
    }
    placeHolderEl.style.display = 'none';
    elements.tabs.classList.remove('expanded');
    return lastStateIsExpanded = false;
  };

  selectTab = function(tabName) {
    if (tabName === lastSelectedTab) {
      return;
    }
    unselect(lastSelectedTab);
    select(tabName);
    return lastSelectedTab = tabName;
  };

  select = function(tabName) {
    if (tabName != null) {
      elements[tabName].tab.classList.add('selected');
      return history.pushState(null, null, "#" + tabName);
    }
  };

  unselect = function(tabName) {
    if (tabName != null) {
      return elements[tabName].tab.classList.remove('selected');
    }
  };

  window.addEventListener('scroll', updateTabsPosition);

}).call(this);
